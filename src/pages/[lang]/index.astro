---
import Layout from "../../layouts/Layout.astro";
import PostCard from "../../components/PostCard.astro";
import { getCollection } from "astro:content";
import { useTranslations } from "../../i18n/utils";

export function getStaticPaths() {
  return [{ params: { lang: "vi" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params;
const t = useTranslations(lang as any);
const posts = (await getCollection("blog"))
  .filter((post) => post.data.lang === lang)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<Layout title="Hải Phạm | Backend Blog" lang={lang}>
  <section class="hero">
    <img src="/assets/avatar.jpg" alt="Avatar" class="avatar" />
    <div class="hero-text">
      <h1>{t("home.hero.title")}</h1>
      <p>
        {t("home.hero.desc")}
      </p>
      <div class="hero-actions">
        <a class="btn" href={`/${lang}/blog`}>{t("home.hero.readBlog")}</a>
        <a class="btn-outline" href={`/${lang}/about`}>{t("home.hero.about")}</a
        >
      </div>
      <div class="socials">
        <a href="https://github.com/haiphamcoder" target="_blank" rel="noopener"
          >GitHub</a
        >
        <span>·</span>
        <a
          href="https://www.linkedin.com/in/haiphamcoder"
          target="_blank"
          rel="noopener">LinkedIn</a
        >
      </div>
    </div>
  </section>

  <section class="latest">
    <div class="section-header">
      <h2>{t("home.latest.title")}</h2>
      <a href={`/${lang}/blog`}>{t("home.latest.viewAll")}</a>
    </div>
    <div class="post-grid">
      {
        posts.map((post) => (
          <PostCard
            title={post.data.title}
            date={post.data.date.toISOString().split("T")[0]}
            tags={post.data.tags}
            excerpt={post.data.excerpt || ""}
            href={`/blog/${post.id
              .replace(/\.(en\.)?md$/, "")
              .split("/")
              .pop()}`}
            lang={post.data.lang}
          />
        ))
      }
    </div>
  </section>
</Layout>
